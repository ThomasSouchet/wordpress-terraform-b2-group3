#!/bin/bash -x

echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC9CWCoJqVIfUFaB2ugdhuYuIaUB3YGcTW+GksMXkF9SyNiFm3f9SC5EYpCGzR9YcRFhyolsZyKGFv9HUFEybIZ5fqF9LoCAWRTJJW79oZtcJjKsIt9aAydVp+rlaxsWdRNFd40V/+4XJXJ6WyJbjPJ5fyUcdg/6GMPMsiCniL65HeMDkWkEZ9ML/f5c3L9N3jgF+yKemG5sAkLe8rjBbvvSUh+yCVsXHDYVhjV7Lg2olG2uHOu0Az/8ptuQnqJMMdG3S2vqx58+19W2pGsrEYceoN/4N4spVtn0MbuqqRKA4Fn6i02vi+m+48Z72y7rwUHsleOXd9orB6yc5fBrhnJjtVFLGdJUAWiLGVGqkrDsC7oyEL9CZYcsDJ0BWncGMH686KK/uKZTmJCTo2SpUsgZvIvWGAaTIIPaik05CwWmDN9/TKZjFh7Qrl/Mnt7gj2bLOzlfTi7IebzMOyH57ovmktnIjB8xZE4kWgvyp90AcMnEwD70yDr7BAltkytGGe7VhC7IKSVzhCUvvhyPRfVhRWxQT/pWfR/tr8EdOLGZ+IX5ozQ57JfCYVGbGV3lNTQmtcwbWN4tUWUt2SOdzQSB/XCGvjVG2eMgiWFXaX525qP5CgFx64UCI/DqgRpjYeTzGpi431XcT6vJQhwVpAJMFnRCaOqn+J6UWRoUva41w== abdelkader.hadri@gmail.com" > /home/ubuntu/.ssh/authorized_keys
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAAkR77pXTv/XdyurqzdR9JITg+93ofhmmtvoqcAtqgOn+2J2twTy+kGxlBtLYIQ4bzvxP+s3oSbbKQy2CQtsGPtNzq1zCzYbPKS9wfJogt7WGnKazqIz2yHTLQeuS2V5MTuc46eOmVqoh8wDTM0XmP4Hh084yByI5CqNwSbGu1kEeExrkGOcHaLFTwEIny01e6u8WgX9QH99eG/uCQ+UcxAq8w+PumCnRJWpI/2kccWfh2l/dYKypCqGaCbzG/9EknUoRppM9pjG45ZxKqzzo0E3zo3YCZHpYpIyACarJ8RLBQHi+EFrhjTQ6/WMfVp+1N0ijq2kUJZ80DlVZq3VD nononm33" >> /home/ubuntu/.ssh/authorized_keys
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDsyc/iZhHjCYnuuiluLnHKZh9WC52n4XPuoHumk1e0tDybDUdmd0Uh90jONYdbuYP+dPlzFj7yq6JH6ennN4OfycCx1/qsTpF4yReOKwy9Z/bRmrj3jhkSYwE/mKjqkDQrWkvziu879IxQHa6izzg7VbxDjLHJJw59PewwL4a7UK+THJ24O7eJsuv/xq3B3Cgg661qNS3m/Rzw/y0S1eHTS0SE+vmNMaDJ5iRptWBboJACPzm/jojsB6cv8xjiw7KM1OuTzbnvfGCbekb+ovpeZC3ADtd13b2pESDdaC3ot8T1iaJULErrNiMUQybF1ljwGt64smtR9y6s4wXDu2igCzpMRo790NBocxiyqy9Hm9BMtlf9Ho7VOhN7klxq0gIspwJpO5N1LEF8DBgQbavSxY7Gyi0k6qt7l3ukNMytLkoukgJ7i3MGtQAuOr0s+N2EhSqB8vhqRfQsZwXmz2aBVohRxOQQl5XKyfWv0mO2IBXFojCoNviS0Xa4gWnFj2c= thomas@DESKTOP-LPDFGAJ" >> /home/ubuntu/.ssh/authorized_keys
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEfihuzJ4NB6vykrNeGKpWqvAktkL5xXfuUeFGd2h9Ei kamelsi@hotmail.com" >> /home/ubuntu/.ssh/authorized_keys
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC1/r9Rb8YHUlVJJBkn3dVWI6aiQfOCzKCqod2XspTStOvIhvUs5zZVqIUfL8abqU1httLx1yY/9FM2SNb5WdOHkmBo5wowwJifdqhfGBzgNUEJM8OHvc5Sofj9v+CQzR5TOtI8WHuz2B26CtzMBmEgqRR/PSEjniKoAgeHT+Y609vMvEglRieNu57aS+qza4adaq+gF9XRXa5LSBtDo92HusaZqAq10WXmsCUdXdbomJy5fMaHV9Lzil/4OZ6qabssmE0HNLNwnIsAGQ3YEhX3Heo5YpIdeko8MdLiMyuc70lE1hcttTkwIrkYh7qgnuJtjubUeT5nmVOE07wvs9aJVuyFTIzOGUE0tdfWFMoqXKu1ICYXt+Q7WgJBeJIdIwUnvZNYNGwWph6yT8/THohw4uTBSIcw5OnOH9mPEv4QKKh6hdsSMeDTr/suLjtmCBwkz8bgUQNawDLOo1jQYyAff28p7xhA/wgnF8i1LqxM5C5fTGXKjxW/roRB1dJS1X40xB8xf42HiDvKmFuetXAAt/KdFsRZbEA8wrTDYNpnwFs/SkeMG6UiDBgBZejdLU05eeSLuS8ya6TGsS0dUdaY4rB+ozeDdqVSRUGxhwCA3SoRJAPYOXZsJzFbqX2dYnHUka89RUXYYToSklPy6P3n4wKzZoasKSxNnDCMlMw25Q== paul@DESKTOP-45K4G0O" >> /home/ubuntu/.ssh/authorized_keys

sudo apt-get update
sudo apt install -y apache2 \
                    ghostscript \
                    libapache2-mod-php \
                    mysql-client \
                    php \
                    php-bcmath \
                    php-curl \
                    php-imagick \
                    php-intl \
                    php-json \
                    php-mbstring \
                    php-mysql \
                    php-xml \
                    php-zip \
                    ruby-full \
                    wget

sudo mkdir -p /srv/www
sudo chown www-data: /srv/www

sudo tee /etc/apache2/sites-available/wordpress.conf << EOF
DocumentRoot /srv/www/wordpress
<Directory /srv/www/wordpress>
    Options FollowSymLinks
    AllowOverride Limit Options FileInfo
    DirectoryIndex index.php
    Require all granted
</Directory>
<Directory /srv/www/wordpress/wp-content>
    Options FollowSymLinks
    Require all granted
</Directory>
EOF

sudo a2ensite wordpress
sudo a2enmod rewrite
sudo a2dissite 000-default
sudo service apache2 reload

# install code deploy
wget https://aws-codedeploy-eu-north-1.s3.eu-north-1.amazonaws.com/latest/install
chmod +x ./install
sudo ./install auto > /tmp/logfile
sudo service codedeploy-agent restart
rm -fr install

# install AWS CLI
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
rm -f awscliv2.zip
rm -fr aws

# install Wordpress CLI
curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar
chmod +x wp-cli.phar
mv wp-cli.phar /usr/local/bin/wp
